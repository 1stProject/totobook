<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="totoBook.store.mapper.ReviewMapper">

 	<resultMap type="Review" id="ReviewMap">
		<result property="comment" column="content"  />
		<association property="member" column="member_id"
			select="totoBook.store.mapper.MemberMapper.selectMemberById"
			javaType="Member" jdbcType="VARCHAR" />
		<association property="product" column="product_id"
			select="totoBook.store.mapper.ProductMapper.selectProductById"
			javaType="Product" jdbcType="VARCHAR" />

 		<!-- <result column="image_address" property="imageAddress"/>
 -->
	</resultMap>

<!-- 
	<select id="selectMember" resultMap="String">
		SELECT member_Id from
		member_tb WHERE member_id = #{memberId}
	</select>

	<select id="selectProduct" resultType="String">
		Select Proudct_id from
		product_tb where product_id = #{productId}
	</select>
	<select id="selectPhoto" resultType="Photo">
		Select image_address
		image_ext from photo_tb where image_address =#{image_address}
	</select>
 -->


	<insert id="insertComment" parameterType="Review">
		INSERT INTO
		REVIEW_TB(MEMBER_ID, PRODUCT_ID, CONTENT, IMAGE_ADDRESS,
		IMAGE_EXT)
		values(#{memberid}, #{productid}, #{content}, #{IMAGE_ADDRESS},
		#{IMAGE_EXT})

	</insert>

	<update id="updateComment" parameterType="Review">
		Update review_tb
		set
		content = #{CONTENT}, image_address = #{IMAGE_ADDRESS}, IMAGE_EXT =
		#{IMAGE_EXT})
		where MEMBER_ID = #{MEMBER_ID}, PRODUCT_ID =
		#{PRODUCT_ID}
	</update>

	<delete id="deleteCommentByMember">
		DELETE review_tb
		WHERE MEMBER_ID = #{MEMBER_ID}
	</delete>

	<delete id="deleteCommentByProduct">
		DELETE review_tb
		WHERE MEMBER_ID = #{PRODUCT_ID}
	</delete>

	<select id="selectCommentsByProduct" parameterType="String"	resultMap="ReviewMap">>
		Select
		MEMBER_ID, PRODUCT_ID, CONTENT, IMAGE_ADDRESS,
		IMAGE_EXT
		FROM
		REVIEW_TB
		where PRODUCT_ID = #{PRODUCT_ID}

	</select>


	<select id="selectCommentsByMember" parameterType="String" resultMap="ReviewMap">
		Select MEMBER_ID, PRODUCT_ID, CONTENT, IMAGE_ADDRESS,
		IMAGE_EXT
		FROM
		REVIEW_TB where MEMBER_ID = #{memberId}
	</select>

</mapper>